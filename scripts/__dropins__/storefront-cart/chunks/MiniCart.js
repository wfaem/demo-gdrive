import{jsx as e,jsxs as d,Fragment as G}from"@dropins/tools/preact-jsx-runtime.js";import{useState as N,useEffect as g,useCallback as H}from"@dropins/tools/preact-compat.js";import{classes as p,VComponent as f,Slot as k}from"@dropins/tools/lib.js";import{g as M}from"./persisted-data.js";import{events as P}from"@dropins/tools/event-bus.js";/* empty css             */import{Price as Q,Button as S}from"@dropins/tools/components.js";import{useText as T}from"@dropins/tools/i18n.js";import{s as _}from"./resetCart.js";import{a as D,b as X}from"./acdl.js";import{u as O}from"./updateProductsFromCart.js";import"./CartSummaryGrid.js";import{C as R}from"./CartSummaryList.js";import"./OrderSummary.js";const j=({className:h,products:n,orderSummary:i,empty:r,...a})=>e("div",{...a,className:p(["cart-cart",h]),children:d("div",{className:p(["cart-cart__wrapper"]),children:[e("div",{"data-testid":"cart-content",className:p(["cart-cart__content",["cart-cart__content--empty",r||i==null],["cart-cart__content--full-width",r||i==null]]),children:n&&e(f,{node:n})}),n&&i&&e(f,{node:i,className:p(["cart-cart__order-summary"])})]})}),A=({className:h,products:n,subtotal:i,subtotalExcludingTaxes:r,ctas:a,...m})=>{const o=T({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return e("div",{...m,className:p(["cart-mini-cart",h]),children:n&&d(G,{children:[e("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:n}),d("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[i&&d("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[o.subtotal,e(f,{node:i})]}),r&&d("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[o.subtotalExcludingTaxes,e(f,{node:r,className:p(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),a&&e(f,{node:a,className:"cart-mini-cart__footer__ctas"})]})]})})},F=({children:h,routeProduct:n,routeEmptyCartCTA:i,slots:r,initialData:a=null,...m})=>{const[o,v]=N(a),[t,C]=N(new Map),c={hasErrors:t.size>0},b=(s,y)=>O([{uid:s,quantity:y}]);g(()=>{const s=P.on("cart/data",y=>{v(y)},{eager:!0});return()=>{s==null||s.off()}},[]),g(()=>{a&&Object.keys(a).length>0&&D(a,_.locale??"en-US")},[a]);const x=r!=null&&r.OrderSummary?e(k,{name:"OrderSummary",slot:r.OrderSummary,context:{...c}}):void 0,I=s=>b(s,0),u=e(k,{name:"ProductList",slot:r==null?void 0:r.ProductList,context:{itemQuantityUpdateHandler:b,itemRemoveHandler:I},children:e(R,{"data-testid":"default-cart-summary-list",routeProduct:n,routeEmptyCartCTA:i,initialData:o,enableRemoveItem:!0,enableUpdateItemQuantity:!0,onItemsErrorsChange:C})});return e(j,{...m,empty:((o==null?void 0:o.items)&&o.items.length===0)??!0,orderSummary:x,products:u})};F.getInitialData=async function(){return M()};const V=({children:h,initialData:n=null,slots:i,routeProduct:r,routeCart:a,routeCheckout:m,routeEmptyCartCTA:o,...v})=>{var U,E;const[t,C]=N(n),c=(U=_.config)==null?void 0:U.shoppingCartDisplaySetting;g(()=>{const l=P.on("cart/data",L=>{C(L)},{eager:!0});return()=>{l==null||l.off()}},[]);const b=T({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),x=(l,L)=>O([{uid:l,quantity:L}]),I=l=>x(l,0),u=t==null?void 0:t.hasOutOfStockItems,s=H(()=>{t&&!u&&X(t,_.locale)},[t,u]);g(()=>{n&&Object.keys(n).length>0&&D(n,_.locale||"en-US")},[n]);const y=e(k,{name:"ProductList",slot:i==null?void 0:i.ProductList,context:{itemQuantityUpdateHandler:x,itemRemoveHandler:I,totalQuantity:t==null?void 0:t.totalQuantity},children:e(R,{"data-testid":"default-cart-summary-list",routeProduct:r,routeEmptyCartCTA:o,initialData:t,maxItems:(E=_.config)==null?void 0:E.miniCartMaxItemsDisplay,hideHeading:!(t!=null&&t.totalQuantity),enableRemoveItem:!0})}),w=()=>(c==null?void 0:c.subtotal)==="INCLUDING_TAX"||(c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return e(A,{...v,subtotal:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&e(Q,{...w()}):void 0,subtotalExcludingTaxes:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&((c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(Q,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0):void 0,ctas:t!=null&&t.totalQuantity?d("div",{children:[m&&e(S,{"data-testid":"route-checkout-button",variant:"primary",href:u?void 0:m(),disabled:u,"aria-disabled":u,onClick:s,children:b.checkoutLink}),a&&e(S,{"data-testid":"route-cart-button",variant:"tertiary",href:a(),children:b.cartLink})]}):void 0,products:y})};V.getInitialData=async function(){return M()};export{F as C,V as M};
