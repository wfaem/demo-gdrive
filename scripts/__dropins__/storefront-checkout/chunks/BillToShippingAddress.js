import{jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import"@dropins/tools/event-bus.js";import{n as g,v as h,w as k}from"./getCart.graphql.js";import{s as S}from"./setBillingAddress.js";import{classes as b}from"@dropins/tools/lib.js";import{Checkbox as v,Skeleton as C,SkeletonRow as _}from"@dropins/tools/components.js";import{useText as y}from"@dropins/tools/i18n.js";import{useState as A,useEffect as f}from"@dropins/tools/preact-compat.js";function B(t){return t.displayName||t.name||"Component"}const I=({className:t,isInitialized:s=!0,checked:i=!0,...n})=>{const e=y({title:"Checkout.BillToShippingAddress.title"});return s?l("div",{className:b(["checkout-bill-to-shipping-address",t]),children:l(v,{"data-testid":"bill-to-shipping-checkbox",className:"checkout-bill-to-shipping-address__checkbox",checked:i,name:"checkout-bill-to-shipping-address__checkbox",label:e.title,...n})}):l(N,{})},N=()=>l(C,{className:"bill-to-shipping-address__skeleton",children:l(_,{variant:"row",size:"small"})}),m="is_bill_to_shipping_address",x=t=>{const s=B(t),i=({hideOnEmptyCart:n=!0,hideOnVirtualCart:e=!1,...c})=>{const r=g.value.data,a=r!==void 0&&(r===null||r.isEmpty),o=!!(r!=null&&r.isVirtual);return n&&a||e&&o?null:l(t,{...c})};return i.displayName=`Conditional(${s})`,i};function T(t,s,i){const n=t[i],e=s[i];return n===void 0&&e===void 0||n===null&&e===null?!0:typeof n=="object"&&typeof e=="object"?JSON.stringify(n)===JSON.stringify(e):n===e}function w(t,s,i){return!s&&!i?!0:!s||!i?!1:t.every(n=>{const e=n.code;return T(s,i,e)})}const z=({isBillToShipping:t})=>{var u;const[s,i]=A(!1),n=k.value.data,e=g.value.data,c=(e==null?void 0:e.id)||"",r=!!e,a=e==null?void 0:e.billingAddress,o=(u=e==null?void 0:e.shippingAddresses)==null?void 0:u[0],d=!!o;return f(()=>{if(s)return;const p=localStorage.getItem(m);p&&(i(!0),t.value={checked:p==="true",setByUser:!1})},[s,t]),f(()=>{if(s||!n||!r)return;i(!0);const p=w(n,a,o);t.value={checked:a?p:t.value.checked,setByUser:!1}},[a,n,r,t,s,o]),{cartId:c,isInitialized:s,hasShippingAddress:d}},E=({children:t,...s})=>{const i=h.value.checked,{hasShippingAddress:n,isInitialized:e}=z({isBillToShipping:h});return l(I,{...s,checked:i,isInitialized:e,onChange:r=>{const o=r.target.checked;if(h.value={checked:o,setByUser:!0},localStorage.setItem(m,o.toString()),!e||!o||!n)return;const d=new AbortController;return S({signal:d.signal,input:{same_as_shipping:!0}}).catch(u=>{console.error(u)}),()=>{d.abort()}},disabled:g.value.pending})},P=x(E);export{P as B,m as a,w as c,x as w};
